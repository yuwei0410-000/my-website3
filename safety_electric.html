<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ğŸ’¡ é›»å™¨å®‰å…¨åˆ¤æ–·</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    nav {
      background-color: #f0f0f0;
      padding: 10px;
      text-align: center;
    }
    nav a {
      margin: 0 12px;
      text-decoration: none;
      color: #333;
      font-weight: bold;
    }
    button {
      margin: 5px;
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">ğŸ  é¦–é </a>
    <a href="announcements.html">ğŸ“¢ æœ€æ–°å…¬å‘Š</a>
    <a href="course.html">ğŸ“˜ èª²ç¨‹ç·´ç¿’</a>
    <a href="review.html">ğŸ† å€‹äººæˆæœ</a>
    <a href="admin.html">ğŸ“Š æˆç¸¾æª¢è¦–</a>
    <a href="profile.html">âš™ï¸ è¨­å®š</a>
  </nav>

  <h1>ğŸ’¡ é›»å™¨å®‰å…¨åˆ¤æ–·å°éŠæˆ²</h1>
  <p>è«‹åˆ¤æ–·ä¸‹åˆ—è¡Œç‚ºæ˜¯å¦å®‰å…¨ã€‚</p>

  <div id="quiz-container">
    <p id="question-text"></p>
    <button onclick="submitAnswer('safe')">é€™æ˜¯å®‰å…¨çš„</button>
    <button onclick="submitAnswer('danger')">é€™æ˜¯å±éšªçš„</button>
    <p id="feedback"></p>
    <p id="explanation" style="color: #888;"></p>
    <button id="next-button" style="display:none;" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ</button>
    <p id="progress"></p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDTfQ0US5aQqwg6rmBAF8SGew6a0MMMmaY",
      authDomain: "s11155037-chimo.firebaseapp.com",
      projectId: "s11155037-chimo",
      databaseURL: "https://s11155037-chimo-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    let currentUserId = null;
    let currentQuestion = 0;
    let correctCount = 0;
    let isAnswered = false;

    const allQuestions = [
      { text: "æ¿•æ‰‹ç¢°æ’é ­", correct: "danger", explanation: "æ¿•æ‰‹å®¹æ˜“å°é›»ï¼Œå¯èƒ½å°è‡´è§¸é›»ï¼Œéå¸¸å±éšªã€‚" },
      { text: "æ’é ­ç ´æä»ä½¿ç”¨", correct: "danger", explanation: "æ’é ­ç ´æå¯èƒ½å°è‡´æ¼é›»æˆ–çŸ­è·¯ï¼Œæ‡‰ç«‹å³æ›´æ›ã€‚" },
      { text: "ä¹¾æ‰‹æ’æ‹”é›»å™¨", correct: "safe", explanation: "ä¹¾æ‰‹æ’æ‹”é›»å™¨æ˜¯æ­£ç¢ºçš„åšæ³•ï¼Œå¯é™ä½è§¸é›»é¢¨éšªã€‚" },
      { text: "åœ¨æµ´å®¤ç”¨å»¶é•·ç·š", correct: "danger", explanation: "æµ´å®¤æ½®æ¿•ï¼Œç”¨å»¶é•·ç·šéå¸¸å±éšªï¼Œå®¹æ˜“è§¸é›»ã€‚" },
      { text: "æ‹”æ’é ­å‰å…ˆé—œé›»æº", correct: "safe", explanation: "å…ˆé—œé›»æºèƒ½é¿å…æ‹”æ’é ­æ™‚ç”¢ç”Ÿç«èŠ±ã€‚" },
      { text: "å°‡é›»ç·šæ”¾åœ¨åœ°ä¸Šè®“äººè¸©", correct: "danger", explanation: "é›»ç·šè¢«è¸©å®¹æ˜“æå£ï¼Œç”šè‡³å¼•èµ·ç«ç½ã€‚" },
      { text: "é›»å™¨é è¿‘æ°´æ§½æ“ºæ”¾", correct: "danger", explanation: "æ°´æœƒå°é›»ï¼Œé›»å™¨æ‡‰é é›¢æ°´æºã€‚" },
      { text: "é›»é¢¨æ‰‡é›»ç·šçºç¹å¤ªç·Š", correct: "danger", explanation: "é›»ç·šå¤ªç·Šå¯èƒ½å°è‡´ç ´çš®ï¼Œå±éšªã€‚" },
      { text: "é•·æ™‚é–“ä½¿ç”¨å»¶é•·ç·š", correct: "danger", explanation: "é•·æ™‚é–“ä½¿ç”¨æœƒå°è‡´éç†±ï¼Œæœ‰ç«ç½é¢¨éšªã€‚" },
      { text: "é›»å™¨é–’ç½®æ™‚æ‹”æ‰æ’é ­", correct: "safe", explanation: "å¯é¿å…é›»å™¨å¾…æ©Ÿè€—é›»å’Œçªç™¼å±éšªã€‚" },
      { text: "ç”¨é›»å™¨å‰å…ˆç¢ºèªæ’é ­æœ‰ç„¡ç ´æ", correct: "safe", explanation: "å®‰å…¨æª¢æŸ¥å¯é¿å…é›»å™¨æ•…éšœèˆ‡å±éšªã€‚" },
      { text: "æ´—æ¾¡æ™‚ä½¿ç”¨æ‰‹æ©Ÿå……é›»å™¨", correct: "danger", explanation: "æ°´æ°£èˆ‡å……é›»å™¨æ¥è§¸å¯èƒ½å°è‡´è§¸é›»ã€‚" },
      { text: "é›»ç·šæ¥é ­ç”¨è† å¸¶éš¨æ„çºç¹", correct: "danger", explanation: "é€™æ¨£å®¹æ˜“å¼•ç™¼çŸ­è·¯æˆ–æ¼é›»ã€‚" },
      { text: "æ’é ­æ’ä¸é€²å»å°±ç”¨åŠ›æ’", correct: "danger", explanation: "å¼·è¡Œæ’å…¥å¯èƒ½æå£æ’åº§ä¸¦å°è‡´è§¸é›»ã€‚" },
      { text: "ä½¿ç”¨é›»å™¨æ™‚é›™æ‰‹ä¿æŒä¹¾ç‡¥", correct: "safe", explanation: "å¯å¤§å¹…é™ä½è§¸é›»é¢¨éšªã€‚" },
      { text: "ä½¿ç”¨å¤šå­”æ’åº§ä¸€æ¬¡æ’å¾ˆå¤šé›»å™¨", correct: "danger", explanation: "è¶…è¼‰å¯èƒ½å°è‡´éç†±èˆ‡ç«ç½ã€‚" },
      { text: "å¤œæ™šå¤–å‡ºæ™‚é—œæ‰ä¸å¿…è¦çš„é›»å™¨", correct: "safe", explanation: "é¿å…é›»å™¨éç†±èˆ‡æ„å¤–é¢¨éšªã€‚" },
      { text: "æ‹–ç·šç›¤é‚„æœªæ‹‰é–‹å°±ä½¿ç”¨", correct: "danger", explanation: "é›»ç·šæœªå±•é–‹å®¹æ˜“éç†±ã€‚" },
      { text: "æª¢æŸ¥å»¶é•·ç·šæœ‰ç„¡éç†±ç¾è±¡", correct: "safe", explanation: "å®šæœŸæª¢æŸ¥æœ‰åŠ©æ–¼æ—©æœŸç™¼ç¾å±éšªã€‚" },
      { text: "é›»ç·šç ´æç«‹å³æ›´æ›", correct: "safe", explanation: "é˜²æ­¢æ¼é›»æˆ–ç«ç½ç™¼ç”Ÿã€‚" }
    ];

    const questions = [...allQuestions].sort(() => Math.random() - 0.5);

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "login.html";
      } else {
        currentUserId = user.uid;
        loadQuestion();
      }
    });

    function loadQuestion() {
      const q = questions[currentQuestion];
      document.getElementById("question-text").textContent = q.text;
      document.getElementById("feedback").textContent = "";
      document.getElementById("explanation").textContent = "";
      document.getElementById("next-button").style.display = "none";
      document.getElementById("progress").textContent = `é¡Œç›® ${currentQuestion + 1} / ${questions.length}`;
      isAnswered = false;
    }

    window.submitAnswer = function(answer) {
      if (isAnswered) return;
      isAnswered = true;

      const q = questions[currentQuestion];
      const feedback = document.getElementById("feedback");
      const explanation = document.getElementById("explanation");

      if (answer === q.correct) {
        feedback.textContent = "âœ… ç­”å°äº†ï¼";
        correctCount++;
      } else {
        feedback.textContent = "âŒ ç­”éŒ¯äº†ã€‚";
        explanation.textContent = "ğŸ“˜ è§£æï¼š" + q.explanation;
      }

      document.getElementById("next-button").style.display = "inline-block";
    };

    window.nextQuestion = function() {
      currentQuestion++;
      if (currentQuestion < questions.length) {
        loadQuestion();
      } else {
        document.getElementById("quiz-container").innerHTML = `
          <h2>ğŸ‰ æ¸¬é©—çµæŸ</h2>
          <p>ä½ ç­”å°äº† ${correctCount} / ${questions.length} é¡Œï¼</p>
        `;
        set(ref(db, `users/${currentUserId}/electrical_safety`), {
          result: `å®Œæˆ ${correctCount}/${questions.length}`,
          score: correctCount,
          timestamp: new Date().toISOString()
        });
      }
    };
  </script>
</body>
</html>
